# F2: 아티스트 검색 & RAG - 사용자 여정 (User Flow)

## Acceptance Criteria 요약

| AC ID | 설명 |
|-------|------|
| AC-F2-01 | 사용자가 아티스트를 검색하면 5초 이내에 결과가 반환된다 (캐시 시 즉시) |
| AC-F2-02 | 사용자가 검색 결과에서 행사 정보를 확인할 수 있다 |
| AC-F2-03 | 24시간 내 동일 검색 시 캐시된 결과가 재사용된다 |

### 관련 유저 스토리

**US-4: RAG 기반 검색**
> 팬으로서, 아티스트 이름만으로 모든 행사 정보를 찾고 싶다. 여러 사이트를 돌아다니기 싫다.

- US-4 AC-1: 아티스트 검색 시 웹에서 정보 수집
- US-4 AC-2: 콘서트, 팬미팅, 방송 출연 등 분류
- US-4 AC-3: 검색 결과 캐싱

---

## 1. 전체 사용자 여정

```
┌─────────────────────────────────────────────────────────────────┐
│                     메인 탭 (검색 탭 선택)                         │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │    검색 홈       │
                    │  (최근검색/인기) │
                    └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │  검색어 입력     │
                    └─────────────────┘
                              │
              ┌───────────────┴───────────────┐
              │                               │
              ▼                               ▼
    ┌─────────────────┐             ┌─────────────────┐
    │  자동완성에서      │             │  "웹에서 검색"    │
    │  아티스트 선택     │             │   실행           │
    └─────────────────┘             └─────────────────┘
              │                               │
              ▼                               ▼
    ┌─────────────────┐             ┌─────────────────┐
    │  아티스트 프로필  │             │   검색 결과      │
    │  + 행사 목록     │             │  (RAG 결과)     │
    └─────────────────┘             └─────────────────┘
              │                               │
              └───────────────┬───────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │   행사 상세      │
                    └─────────────────┘
```

---

## 2. 세부 사용자 여정

### Journey 1: RAG 검색으로 행사 찾기

**시작점**: 하단 탭 → 검색 탭 (`/(tabs)/search`)
**종료점**: 행사 상세 정보 확인

| Step | 화면 | 사용자 액션 | 시스템 응답 |
|------|------|-------------|------------|
| 1 | 검색 홈 | 검색 탭 진입 | 최근 검색어, 인기 아티스트, 내 아티스트 표시 |
| 2 | 검색 홈 | 검색창 탭 → 아티스트 이름 입력 | 자동완성 드롭다운 표시 (DB 기반) |
| 3 | 검색 홈 | "🌐 웹에서 검색" 버튼 또는 엔터 탭 | RAG 검색 시작, 로딩 상태 진입, URL: `?q={검색어}` |
| 4 | 검색 결과 | (대기) | 행사 결과 카드 리스트 표시 (카테고리별) |
| 5 | 검색 결과 | 카테고리 필터 탭 (콘서트/팬미팅/방송/페스티벌) | 필터링된 결과만 표시 |
| 6 | 행사 상세 | 행사 카드 탭 | 행사 상세 정보 페이지로 이동 |

### Journey 2: 아티스트 프로필에서 행사 보기

**시작점**: 검색 자동완성에서 아티스트 선택
**종료점**: 아티스트 행사 목록 또는 행사 상세

| Step | 화면 | 사용자 액션 | 시스템 응답 |
|------|------|-------------|------------|
| 1 | 검색 홈 | 검색창에 아티스트 이름 입력 | 자동완성에 아티스트 목록 표시 |
| 2 | 검색 홈 | 자동완성에서 아티스트 항목 탭 | 아티스트 프로필 화면으로 이동 |
| 3 | 아티스트 프로필 | 행사 목록 확인 | 예정 행사 리스트 표시 (날짜순) |
| 4 | 아티스트 프로필 | 팔로우 버튼 탭 | 팔로우 상태 토글, 토스트 표시 |
| 5 | 행사 상세 | 행사 항목 탭 | 행사 상세 정보 페이지로 이동 |

### Journey 3: 최근 검색 / 인기 아티스트로 빠른 접근

**시작점**: 검색 탭 진입
**종료점**: 검색 결과 또는 아티스트 프로필

| Step | 화면 | 사용자 액션 | 시스템 응답 |
|------|------|-------------|------------|
| 1 | 검색 홈 | 검색 탭 진입 | 최근 검색어 칩, 인기 아티스트 그리드 표시 |
| 2a | 검색 홈 | 최근 검색어 칩 탭 | 해당 검색어로 RAG 검색 즉시 실행 |
| 2b | 검색 홈 | 인기 아티스트 카드 탭 | 아티스트 프로필 화면으로 이동 |
| 2c | 검색 홈 | 내 아티스트 카드 탭 | 아티스트 프로필 화면으로 이동 |

---

## 3. 분기점 및 에러 처리

### 자동완성 결과 없음
- **조건**: 입력한 검색어와 일치하는 아티스트가 DB에 없음
- **처리**: 자동완성에 "검색 결과가 없습니다" 표시, "웹에서 검색" 옵션은 유지
- **메시지**: "일치하는 아티스트가 없습니다. 웹에서 검색을 시도해보세요."

### RAG 검색 결과 없음
- **조건**: RAG 파이프라인이 행사 정보를 찾지 못함
- **처리**: Empty State 화면 + 다른 검색어 제안
- **메시지**: "행사 정보를 찾을 수 없습니다. 다른 검색어를 시도해보세요."

### RAG 검색 타임아웃
- **조건**: 검색이 5초를 초과
- **처리**: 타임아웃 에러 메시지 + 재시도 버튼
- **메시지**: "검색에 시간이 오래 걸리고 있습니다. 다시 시도해주세요."

### 네트워크 오류
- **조건**: API 요청 실패
- **처리**: Error State + 재시도 버튼
- **메시지**: "네트워크 연결을 확인해주세요."

### 캐시 히트
- **조건**: 동일 검색어가 24시간 내 검색된 적 있음
- **처리**: 즉시 결과 표시, "캐시됨" 뱃지 표시
- **시각적 표시**: 검색 시간 옆에 "캐시됨" 태그

---

## 4. AC ↔ 화면 매핑

| AC ID | 검증 화면 | 검증 방법 |
|-------|----------|----------|
| AC-F2-01 | 검색 홈 → 검색 결과 (`/(tabs)/search?q=BTS`) | 아티스트 이름 입력 → 검색 실행 → 결과 반환 5초 이내 확인 (캐시 시 즉시, 검색 소요 시간 표시로 검증) |
| AC-F2-02 | 검색 결과, 행사 상세 | 검색 결과 카드에 행사명, 날짜, 장소, 카테고리 표시 확인. 탭 시 행사 상세 확인 |
| AC-F2-03 | 검색 결과 | 동일 검색어 재검색 시 "캐시됨" 뱃지 표시, 즉시 결과 반환 |
| US-4 AC-1 | 검색 결과 | RAG가 웹에서 수집한 정보 표시, 출처 링크 포함 |
| US-4 AC-2 | 검색 결과 | 카테고리 필터 탭: 전체 / 콘서트 / 팬미팅 / 방송 / 페스티벌 |
| US-4 AC-3 | 검색 결과 | "캐시됨" 뱃지 표시, 캐시된 결과는 즉시 로드 |
