# F3: 행사 캘린더 - 사용자 여정 (User Flow)

## Acceptance Criteria 요약

| AC ID | 설명 |
|-------|------|
| AC-F3-01 | 캘린더에서 행사 날짜가 표시된다 |
| AC-F3-02 | 필터로 특정 아티스트만 표시할 수 있다 |
| AC-F3-03 | 행사를 탭하면 상세 정보가 표시된다 |

### 관련 유저 스토리

**US-2: 행사 캘린더 확인**
> 팬으로서, 팔로우한 아티스트들의 행사를 캘린더에서 보고 싶다. 그래야 일정을 놓치지 않는다.

- US-2 AC-1: 월간/주간/일간 캘린더 뷰
- US-2 AC-2: 아티스트별 필터
- US-2 AC-3: 행사 상세 정보

---

## 1. 전체 사용자 여정

```
┌─────────────────────────────────────────────────────────────────┐
│                     메인 탭 (캘린더 탭 선택)                       │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │   캘린더 뷰      │
                    │   (월간 기본)    │
                    └─────────────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
    ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
    │   뷰 모드 전환    │ │  아티스트 필터   │ │  날짜 선택       │
    │ (월간/주간/일간)  │ │     적용        │ │  (행사 있는 날)  │
    └─────────────────┘ └─────────────────┘ └─────────────────┘
              │               │               │
              └───────────────┼───────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │  일간 행사 목록   │
                    │   (선택한 날짜)   │
                    └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │   행사 상세      │
                    │  (모달 or 페이지) │
                    └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │  로컬 캘린더 추가  │
                    │   (선택 기능)     │
                    └─────────────────┘
```

---

## 2. 세부 사용자 여정

### Journey 1: 캘린더에서 행사 확인하기

**시작점**: 하단 탭 → 캘린더 탭 (`/(tabs)/calendar`)
**종료점**: 행사 상세 정보 확인

| Step | 화면 | 사용자 액션 | 시스템 응답 |
|------|------|-------------|------------|
| 1 | 캘린더 | 캘린더 탭 진입 | 현재 월 캘린더 표시, 행사 있는 날짜에 도트 표시 |
| 2 | 캘린더 | 행사가 있는 날짜 탭 | 하단에 해당 날짜의 행사 목록 표시 |
| 3 | 캘린더 | 행사 카드 탭 | 행사 상세 모달/페이지로 이동 |
| 4 | 행사 상세 | 상세 정보 확인 | 행사명, 시간, 장소, 가격, 예매 링크 표시 |

### Journey 2: 뷰 모드 변경하기

**시작점**: 캘린더 탭
**종료점**: 원하는 뷰 모드로 일정 확인

| Step | 화면 | 사용자 액션 | 시스템 응답 |
|------|------|-------------|------------|
| 1 | 캘린더 (월간) | 뷰 모드 토글 탭 (주간) | 주간 뷰로 전환, 현재 주 표시 |
| 2 | 캘린더 (주간) | 뷰 모드 토글 탭 (일간) | 일간 뷰로 전환, 오늘 날짜 표시 |
| 3 | 캘린더 (일간) | 타임라인 스크롤 | 해당 날짜의 행사 타임라인 표시 |
| 4 | 캘린더 (일간) | 좌우 스와이프 | 이전/다음 날짜로 이동 |

### Journey 3: 아티스트 필터 적용하기

**시작점**: 캘린더 탭
**종료점**: 필터링된 행사만 캘린더에 표시

| Step | 화면 | 사용자 액션 | 시스템 응답 |
|------|------|-------------|------------|
| 1 | 캘린더 | 필터 아이콘 탭 | 필터 바텀시트 열림 |
| 2 | 필터 바텀시트 | 팔로우 아티스트 목록 표시 | 체크박스로 선택 가능 |
| 3 | 필터 바텀시트 | 원하는 아티스트 선택/해제 | 선택된 아티스트 하이라이트 |
| 4 | 필터 바텀시트 | "적용" 버튼 탭 | 바텀시트 닫힘, 캘린더에 필터 적용 |
| 5 | 캘린더 | 필터 적용 확인 | 선택된 아티스트 행사만 도트 표시, 필터 뱃지 표시 |

### Journey 4: 로컬 캘린더에 추가하기

**시작점**: 행사 상세 페이지
**종료점**: 기기 캘린더에 일정 추가

| Step | 화면 | 사용자 액션 | 시스템 응답 |
|------|------|-------------|------------|
| 1 | 행사 상세 | "캘린더에 추가" 버튼 탭 | 시스템 캘린더 권한 요청 (최초) |
| 2 | 시스템 다이얼로그 | 권한 허용 | 캘린더 앱 선택 다이얼로그 표시 |
| 3 | 시스템 다이얼로그 | 캘린더 앱 선택 | 행사 정보가 입력된 일정 생성 화면 |
| 4 | 캘린더 앱 | 일정 저장 | 토스트: "캘린더에 추가되었습니다" |

---

## 3. 캘린더 뷰 모드 상세

### 월간 뷰 (Month View) - 기본

```
┌──────────────────────────────────────────┐
│  ◀  2026년 3월  ▶        [월][주][일]   │
├──────────────────────────────────────────┤
│  일   월   화   수   목   금   토        │
├──────────────────────────────────────────┤
│      1    2    3    4    5    6         │
│           ●                              │ ← 행사 있는 날 (도트)
│  7    8    9   10   11   12   13        │
│  ●                   ●                   │
│ 14   15   16   17   18   19   20        │
│           ●●                             │ ← 여러 행사 (복수 도트)
│ 21   22   23   24   25   26   27        │
│  ●         ●                             │
│ 28   29   30   31                        │
└──────────────────────────────────────────┘
│                                          │
│ ──────── 3월 15일 (토) ────────          │ ← 선택된 날짜
│                                          │
│ ┌─────────────────────────────────────┐  │
│ │ 🎤 BTS World Tour                   │  │
│ │ 18:00 | 서울 올림픽 체조경기장        │  │
│ └─────────────────────────────────────┘  │
│ ┌─────────────────────────────────────┐  │
│ │ 🎉 NewJeans Fan Meeting             │  │
│ │ 17:00 | KSPO DOME                   │  │
│ └─────────────────────────────────────┘  │
└──────────────────────────────────────────┘
```

### 주간 뷰 (Week View)

```
┌──────────────────────────────────────────┐
│  ◀  3월 2주  ▶           [월][주][일]   │
├──────────────────────────────────────────┤
│  일9  월10  화11  수12  목13  금14  토15 │
│       ┌───┐                     ┌───┐   │
│       │BTS│                     │NJ │   │
│       │   │                     │   │   │
│       └───┘                     └───┘   │
├──────────────────────────────────────────┤
│ 3월 15일 (토) - 2개 행사                 │
│                                          │
│ ┌─────────────────────────────────────┐  │
│ │ 🎤 BTS World Tour  17:00            │  │
│ │ 서울 올림픽 체조경기장                │  │
│ └─────────────────────────────────────┘  │
└──────────────────────────────────────────┘
```

### 일간 뷰 (Day View)

```
┌──────────────────────────────────────────┐
│  ◀  3월 15일 (토)  ▶     [월][주][일]   │
├──────────────────────────────────────────┤
│ 2개 행사                                 │
├──────────────────────────────────────────┤
│ 17:00 ┌──────────────────────────────┐   │
│       │ 🎉 NewJeans Fan Meeting      │   │
│       │ KSPO DOME                    │   │
│       │ 99,000원 ~                   │   │
│       └──────────────────────────────┘   │
│                                          │
│ 18:00 ┌──────────────────────────────┐   │
│       │ 🎤 BTS World Tour            │   │
│       │ 서울 올림픽 체조경기장         │   │
│       │ 110,000원 ~                  │   │
│       └──────────────────────────────┘   │
│                                          │
│ 19:00                                    │
│ 20:00                                    │
└──────────────────────────────────────────┘
```

---

## 4. 분기점 및 에러 처리

### 행사가 없는 날 선택
- **조건**: 선택한 날짜에 행사가 없음
- **처리**: 하단에 Empty State 표시
- **메시지**: "이 날에는 예정된 행사가 없습니다"

### 팔로우 아티스트 없음
- **조건**: 사용자가 아무 아티스트도 팔로우하지 않음
- **처리**: 전체 캘린더 Empty State
- **메시지**: "팔로우한 아티스트가 없습니다. 아티스트를 팔로우하면 행사가 캘린더에 표시됩니다."
- **액션 버튼**: "아티스트 찾기" → 검색 탭으로 이동

### 필터 적용 후 행사 없음
- **조건**: 필터링된 아티스트의 예정된 행사가 없음
- **처리**: Empty State + 필터 해제 안내
- **메시지**: "선택한 아티스트의 예정된 행사가 없습니다"
- **액션**: "필터 해제" 버튼

### 로컬 캘린더 권한 거부
- **조건**: 사용자가 캘린더 권한을 거부함
- **처리**: 권한 안내 다이얼로그
- **메시지**: "캘린더에 추가하려면 권한이 필요합니다"
- **액션**: "설정에서 권한 허용" → 앱 설정으로 이동

### 네트워크 오류
- **조건**: API 요청 실패
- **처리**: Error State + 재시도 버튼
- **메시지**: "행사 정보를 불러올 수 없습니다. 네트워크를 확인해주세요."

---

## 5. AC ↔ 화면 매핑

| AC ID | 검증 화면 | 검증 방법 |
|-------|----------|----------|
| AC-F3-01 | 캘린더 (월간/주간/일간) | 행사가 있는 날짜에 도트/블록 표시 확인 |
| AC-F3-02 | 필터 바텀시트, 캘린더 | 필터 적용 → 선택된 아티스트 행사만 표시 확인 |
| AC-F3-03 | 행사 상세 | 행사 카드 탭 → 상세 정보 (시간, 장소, 가격, 예매 링크) 표시 확인 |
| US-2 AC-1 | 캘린더 | 뷰 모드 토글로 월간/주간/일간 전환 가능 확인 |
| US-2 AC-2 | 필터 바텀시트 | 팔로우 아티스트 목록에서 다중 선택 가능 확인 |
| US-2 AC-3 | 행사 상세 | 행사명, 시간, 장소, 가격, 카테고리, 예매 링크 표시 확인 |

---

## 6. 데이터 흐름

### 캘린더 데이터 로딩

```
사용자 진입
     │
     ▼
┌─────────────────────┐
│ 현재 월의 행사 로드   │  GET /api/v1/events?from_date={월 시작}&to_date={월 끝}
└─────────────────────┘
     │
     ▼
┌─────────────────────┐
│ 아티스트 필터 적용   │  (클라이언트 필터링 또는 artist_id 파라미터)
└─────────────────────┘
     │
     ▼
┌─────────────────────┐
│ 캘린더에 도트 렌더링  │  날짜별 그룹핑
└─────────────────────┘
```

### 뷰 변경 시 데이터 범위

| 뷰 모드 | 데이터 범위 |
|---------|------------|
| 월간 | 표시 월의 전체 일자 |
| 주간 | 표시 주의 7일 |
| 일간 | 선택된 날짜 1일 |

### 로컬 캘린더 추가 데이터

```
{
  title: "BTS World Tour",
  startDate: "2026-03-15T18:00:00+09:00",
  endDate: "2026-03-15T21:00:00+09:00",
  location: "서울 올림픽 체조경기장",
  notes: "예매 링크: https://...",
  url: "https://app.example.com/events/{id}"
}
```
